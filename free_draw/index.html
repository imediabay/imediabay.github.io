<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Draw, Add Text, and Share Image</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 30px;
    }
    canvas {
      border: 1px solid #000;
      margin-top: 20px;
      background-color: #f2f2f2;
    }
    #download-btn {
      display: block;
      margin-top: 20px;
    }
    #draw-area {
      border: 2px dashed red;
      position: absolute;
      top: 50%;
      left: 50%;
      width: 188.975px;  /* 5 cm in pixels */
      height: 264.565px; /* 7 cm in pixels */
      margin-left: -94.4875px; /* Half the width */
      margin-top: -132.2825px;  /* Half the height */
      pointer-events: none;  /* Just for visual reference */
    }
    /* Mobile specific styles */
    @media (min-width: 768px) {
      body {
        display: none;
      }
      #mobile-warning {
        display: block;
      }
    }
    #mobile-warning {
      display: none;
      font-size: 18px;
      color: red;
      padding: 20px;
      background-color: #ffcccb;
      border-radius: 5px;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>Draw, Add Text, and Share Image</h1>

  <!-- Mobile/tablet only message -->
  <div id="mobile-warning">
    This application is only available on mobile and tablet devices.
  </div>

  <br />

  <!-- Canvas for drawing -->
  <canvas id="canvas"></canvas>

  <br />
  
  <!-- Button to download the image -->
  <button id="download-btn">Download Image</button>

  <br />
  <!-- Text below the image for sharing -->
  <p>
    <a id="promo-link" href="https://www.example.com" target="_blank" style="color: blue;">Check out our amazing promotion!</a>
  </p>

  <div id="draw-area"></div>

  <script>
    // Check if the user is on a mobile or tablet device
    function isMobileOrTablet() {
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      return /android/i.test(userAgent) || /iphone|ipod/i.test(userAgent) || /ipad/i.test(userAgent);
    }

    if (!isMobileOrTablet()) {
      document.body.innerHTML = '<div style="text-align: center; margin-top: 50px;">This application is only available on mobile and tablet devices.</div>';
    }

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const drawArea = document.getElementById("draw-area");
    let backgroundImage = new Image();
    let isDrawing = false;
    let lastX = 0, lastY = 0;
    const drawWidth = 188.975;  // 5 cm in pixels
    const drawHeight = 264.565; // 7 cm in pixels

    // Promotional text and link
    const promoText = "Check out our amazing promotion!";
    const promoLink = "https://www.example.com";

    backgroundImage.src = "img.webp";  // Your preloaded image path here

    backgroundImage.onload = function() {
      updateCanvas();
    };

    // Set canvas size to allow drawing and background
    canvas.width = 360;  // Increased width for better space
    canvas.height = 550; // Keeping the same height as the background image

    function updateCanvas() {
      if (backgroundImage) {
        ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height); // Draw static background
      }
      ctx.strokeStyle = 'red'; // Drawing color
      ctx.lineWidth = 5; // Drawing thickness
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
    }

    // Automatically enable drawing
    let drawingEnabled = true;

    // Mobile touch support
    canvas.addEventListener("touchstart", function (e) {
      e.preventDefault(); // Prevent default touch behavior (scrolling, etc.)
      if (drawingEnabled) {
        const touch = e.touches[0];
        const x = touch.clientX - canvas.offsetLeft;
        const y = touch.clientY - canvas.offsetTop;
        // Ensure the drawing is within the allowed region (5x7 cm area)
        if (x >= (canvas.width / 2 - drawWidth / 2) && x <= (canvas.width / 2 + drawWidth / 2) &&
            y >= (canvas.height / 2 - drawHeight / 2) && y <= (canvas.height / 2 + drawHeight / 2)) {
          isDrawing = true;
          lastX = x;
          lastY = y;
        }
      }
    });

    canvas.addEventListener("touchmove", function (e) {
      e.preventDefault(); // Prevent default touch behavior
      if (isDrawing && drawingEnabled) {
        const touch = e.touches[0];
        const x = touch.clientX - canvas.offsetLeft;
        const y = touch.clientY - canvas.offsetTop;
        // Ensure drawing within the allowed region
        if (x >= (canvas.width / 2 - drawWidth / 2) && x <= (canvas.width / 2 + drawWidth / 2) &&
            y >= (canvas.height / 2 - drawHeight / 2) && y <= (canvas.height / 2 + drawHeight / 2)) {
          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
          ctx.lineTo(x, y);
          ctx.stroke();
          lastX = x;
          lastY = y;
        }
      }
    });

    canvas.addEventListener("touchend", function () {
      isDrawing = false;
    });

    // Mouse events for non-touch devices (desktops)
    canvas.addEventListener("mousedown", function (e) {
      if (drawingEnabled) {
        const x = e.clientX - canvas.offsetLeft;
        const y = e.clientY - canvas.offsetTop;
        // Ensure the drawing is within the allowed region (5x7 cm area)
        if (x >= (canvas.width / 2 - drawWidth / 2) && x <= (canvas.width / 2 + drawWidth / 2) &&
            y >= (canvas.height / 2 - drawHeight / 2) && y <= (canvas.height / 2 + drawHeight / 2)) {
          isDrawing = true;
          lastX = x;
          lastY = y;
        }
      }
    });

    canvas.addEventListener("mousemove", function (e) {
      if (isDrawing && drawingEnabled) {
        const x = e.clientX - canvas.offsetLeft;
        const y = e.clientY - canvas.offsetTop;
        // Ensure drawing within the allowed region
        if (x >= (canvas.width / 2 - drawWidth / 2) && x <= (canvas.width / 2 + drawWidth / 2) &&
            y >= (canvas.height / 2 - drawHeight / 2) && y <= (canvas.height / 2 + drawHeight / 2)) {
          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
          ctx.lineTo(x, y);
          ctx.stroke();
          lastX = x;
          lastY = y;
        }
      }
    });

    canvas.addEventListener("mouseup", function () {
      isDrawing = false;
    });

    // Function to add promotional text and link to the image
    function addPromoTextAndLink() {
      ctx.font = "20px Arial";
      ctx.fillStyle = "black";
      ctx.fillText(promoText, 50, canvas.height - 40); // Text position

      // Draw the clickable link (it's static on the canvas as part of the image)
      ctx.font = "16px Arial";
      ctx.fillStyle = "blue";
      ctx.fillText(promoLink, 50, canvas.height - 10);
    }

    // Event listener to download the final image
    document.getElementById("download-btn").addEventListener("click", function () {
      addPromoTextAndLink();
      const finalImage = canvas.toDataURL("image/png");
      const a = document.createElement("a");
      a.href = finalImage;
      a.download = "final_image.png";
      a.click();
    });

  </script>

</body>
</html>
